%li.dropdown{:onclick => "miqToggleUserOptions(event, 'user_options_div')", :style => "cursor: pointer;"}
  %span.pficon.pficon-user
  = "#{session[:username]} | #{session[:vmdb_name]}"
  %b.caret
  %ul.dropdown-menu.topright_menu#user_options_div{:style => "display:none;"}
    %li
      Server: #{session[:vmdb_name]}
    %li
      Group:
      - if session[:eligible_groups].length > 1
        = select_tag("to_group",
                     options_for_select(session[:eligible_groups], session[:group]),
                     {:multiple => false,
                      :title    => "Select to change to another Group",
                      :onclick  => "miqStopBubble(event);",
                      "data-miq_sparkle_on" => true,
                      "data-miq_observe"    => {:url => "/dashboard/change_group"}.to_json})
      - else
        = session[:group_description]
    %li.divider
    %a{:href => "/dashboard/logout", :onclick => 'return miqCheckForChanges()', :title => "Click to Logout"}
      %li.active
        Logout

-Menu::Manager.menu(:top_right) do |menu_section|
  %li.dropdown{:onclick => "miqToggleUserOptions(event, 'custom_menu_div')", :style => "cursor: pointer;"}
    = menu_section.name
    %b.caret
    %ul.dropdown-menu.topright_menu#custom_menu_div{:style => "display:none;"}
      - menu_section.items.each do |menu_item|
        %li
          = menu_item.name

  :javascript
    $j("body").click(function(e) {
      if (!$j(e.target).is('#to_group') && !$j(e.target).is('.topright_menu'))
        $j('.topright_menu:visible').hide();
    });
